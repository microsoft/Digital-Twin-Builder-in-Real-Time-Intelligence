//Start with the function generated by the eventhouse projection to get your time series bus data
Bus_timeseries()
// Parse your travel‑time string into a timespan
| extend TimeToNextStationSpan = totimespan(TimeToNextStation)  
// If ScheduleTime is still text, cast it to real DateTime (drop this line if it's already a DateTime)
| extend ScheduleTime_dt = todatetime(ScheduleTime)      
// Compute when the bus will actually arrive
| extend PredictedArrival = PreciseTimestamp + TimeToNextStationSpan  
// Compare that prediction to the schedule
| extend Delay = PredictedArrival - iff(isnull(ScheduleTime_dt), ScheduleTime, ScheduleTime_dt)
| extend DelayRounded        = format_timespan(Delay, 'hh:mm:ss')
// Flag and label a delay of more than 5 minutes
| extend IsDelayed = Delay > 5m  
| extend DelayLabel = iff(IsDelayed, "Delayed", "On‑Time")              
// Select final output columns
| project
    TripId,
    BusLine,
    StopCode,
    DelayLabel,
    DelayRounded,
    PreciseTimestamp,
    TimeToNextStationSpan,
    PredictedArrival,
    // If you cast above, use ScheduleTime_dt; otherwise, ScheduleTime
    ScheduledArrival = iff(isnull(ScheduleTime_dt), ScheduleTime, ScheduleTime_dt)